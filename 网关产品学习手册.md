# Home
本文档用于指导SSL网关的研发人员进行产品开发相关学习，对应的网关版本为5.2.4 SP5

对于讲师，应该按照此提纲去准备培训材料（并丰富此wiki）

对于学员，应该按照此提纲完成所有功能点的学习和实践

客户端研发人员的培训页面在 这里
## 学习要求
基本项
完成
反向代理
正向代理
VPN
选项
拓展项
完成其他项
## 阶段1：产品使用
从界面配置的角度去理解产品的各项功能
相关资料见 http://git.koal.com/training/gw-training/tree/master/doc/5

网关虚拟机在 \\debian.koal.com\225\02_虚拟机\01_网关产品\SSL-5.2.4_SP5_SSLClient5.3.7

### 基本概念
网络管理
理解网关6个、8个、10个网口的使用
掌握IP地址配置
掌握路由配置
掌握DNS配置
掌握本地域名配置
证书管理
生成证书请求
证书导入
证书链导入
黑名单配置
安全认证服务：SSL反向代理
单个后台应用
多个后台应用（通过虚拟路径区分）
代理TCP应用
安全认证服务：SSL正向代理
SSL客户端
客户端策略（重定向策略，代理策略）
### 主要功能
证书验证
不验证，可选验证，强制验证
本地证书链
SSL Session
黑名单验证
信息绑定
访问控制
### 高级功能
自动登录
POST
前端交互
自定义错误页面
内部页面
外部重定向
日志
运行日志
访问日志
系统日志
### 系统功能
双机热备
SYSLOG转发
SNMP配置
备份/恢复
升级
## 阶段2：产品原理
从配置文件及配置项的角度去理解各项功能
### 主要业务
反向代理
正向代理
虚拟接入
### 系统结构
/kssl目录下各个模块的功能
由cron调用的程序
证书/私钥的存放位置
系统的启动
### 安全认证服务
/kssl/HRP的目录结构

xml/xslt/conf的配置文件读写机制

关键配置文件

proxy.conf
server.conf
xxx.conf
关键数据库文件

xxxx.db
反向代理相关的配置

单个后台应用
多个后台应用（多个虚拟路径）
TCP应用
正向代理相关的

客户端策略ClientPolicy
信息绑定

SSLCookieBindPos指令
SSLCookieBindFileType指令
SSLEncoding指令
SSLURLEncodeEnable指令
cookie.conf中的项
反向代理时的接入控制

正向代理时的访问控制

其他

SSLTimeoutPreHandshake指令
SSLDumpLevel指令
SSLUsrRolePrimaryKey指令
对明文请求的自动重定向
TCP代理时的访问日志记录
## 阶段3：产品技术
从代码实现的角度去理解各项功能
### 安全认证服务HRP
#### 反向代理
基于HTTPS的反向代理（Apache默认实现）
Host和Location的改写
绝对地址和base标签的影响
多主机虚拟路径
SSL错误延迟处理
#### 正向代理（结合客户端）
基于HTTPS的正向代理（格尔扩展实现）
客户端截获数据方式
Tunnel协议
对TUNNEL请求的处理
整个Apache中对TCP消息的处理（M_TUNNEL_TCP）
TCP的处理——mod_proxy_tunnel
正向代理和tunnel
#### SSL的处理
协议参数（协议版本、算法组合）
证书验证及黑名单验证
黑名单更新的信号处理
握手阶段的错误延迟处理
对SSL Session的处理
Apache Filter机制与OpenSSL BIO机制的组合
SSLHandshakeTimeout的用途和原理
#### mod_ssl实现的信息绑定（传统版本）
证书项和编码
非证书项的绑定，TunnelVar
信息绑定和访问日志的关系
UrlEncode，应用获取Cookie和Header的方式
#### mod_uaa实现的信息绑定（新版本）
证书项和编码
非证书项的绑定，TunnelVar
信息绑定和访问日志的关系
UrlEncode，应用获取Cookie和Header的方式
#### 接入控制
配置文件和数据库
mod_ssl_acl_sqlite的分析
接入控制的流程（配置，数据库记录，HRP更新，HRP执行）
#### 访问控制
配置文件和数据库
mod_ssl_acl_sqlite的分析
访问控制的流程（配置，数据库记录，HRP更新，HRP执行）
#### mod_pmc实现的接入控制和访问控制
接入控制的流程（配置，更新，执行）
访问控制的流程（配置，更新，执行）
#### 自定义错误页面
默认HRP实现
mod_fep实现（包括与mod_ssl/mod_pmc等模块的联动）
#### 自动登录
配置文件和数据库
mod_ssl_usermap/mod_rewrite/mod_proxy对自动登录的实现分析
4种自动登录实现
HTTP Basic
POST替换
FORM替换
ADMIN协议
#### 其他
数据Dump的实现（前端，后端，明文，密文）
额外的访问日志字段（流量）
TCP的访问日志实现
HTTP to HTTPS
### 虚拟接入服务VPN
插件与脚本
在线用户列表
### 黑名单管理CRL
LDAP下载
HTTP下载
CRL文件上传
Cache的生成，Cache相关的命令行
对HRP/VPN服务的更新通知
### 管理界面WEBUI
#### 用户和权限管理
用户的增删改查
规则角色和用户角色
应用的增删改查，不同的应用类型
访问控制策略
正向代理策略
反向代理策略
接入控制的实现（需要在每个HRP服务实例中配置）
#### 系统功能
三权分立模式和单权模式
管理员用户/密码的存放和验证
操作日志的记录
时间配置和NTP
#### 系统
#### 热备
Heardbeat的运行机制
热备的关键资源
主备切换后ARP的更新
#### 备份和恢复
备份包的格式
可选备份的实现（界面选择只备份部分服务的数据）
热备模式下的配置同步
#### 升级
网关5系列升级包制作方法及原理
网关6系列升级包制作方法及原理
#### 日志和报警
syslog-ng配置
本地日志记录和回滚
syslog日志发送
snmp配置
邮件报警的实现
#### 其他
License的存放和验证
watchdog的工作原理
## 推荐实践
### 反向代理
使用openssl命令行与HRP完成握手
启用HRP的dump功能，查看前后端的明文，密文数据
使用多路径反向代理，在同一个端口上代理多个应用
反向代理IIS应用（Host项改写）
配置后端KeepAlive
配置后端HTTPS，配置代理证书
测试SSLSession的不同配置，对浏览器访问的影响
测试KeepAlive相关配置，对浏览器访问的影响
### 正向代理
使用nc发送TUNNEL协议，下载策略
编写程序，在SSL_connect之前发送TUNNEL头，发起正向代理访问
配置地址伪装功能（HTTP/TCP，参考ASMG网关配置）
配置二级代理及其访问（参考无线网关配置）
通过网络抓包，分析正向代理时，网关对HTTP和TCP处理的不同（同一个Web应用，不同的策略方式）
分析安全认证网关，无线安全网关，ASMG中，对正向代理配置的不同
### 信息绑定
手动修改配置，增加自定义的绑定项（mod_ssl和mod_uaa两种模式都要）
尝试发送伪装的用户证书信息Cookie，观察网关对其作何处理
在HRP配置的证书编码有误时，后端应用如何获取正确的证书信息
在HRP配置的绑定Header名称与HTTP标准名称冲突时，网关作何处理？
HRP无法在证书内获取到对应的项，信息绑定会传递什么值？
### 访问控制
配置10个用户（2个规则角色，2个用户角色），配置不同的访问控制策略
编写一个程序，能自动从公司LDAP(192.168.1.8)中同步用户信息到5.2.4的用户数据库中
编写一个能适配mod_pmc的访问控制服务，进行访问控制测试
### 自动登录
使用表单自动填充模式，配置自动登录公司wiki.koal.com，git.koal.com和dev.koal.com
使用表单自动回放模式，配置自动登录公司wiki.koal.com，git.koal.com和dev.koal.com
配置IIS为Basic验证，使用网关对其进行自动登录
### 安全认证服务其他
修改访问日志配置，将证书DN中的所有项，都分别记录到访问日志中
测试SSLPreHandshakeTimeout值的作用（使用telnet测试）
### 编程实践
OpenSSL编程
编写程序完成SSL握手（RSA，SM2两种算法和协议）
编写程序，在SSL_connect之前发送TUNNEL头，发起正向代理访问
Web编程
在Java/PHP/python中解析网关传递Cookie/Header信息，并进行解码处理
